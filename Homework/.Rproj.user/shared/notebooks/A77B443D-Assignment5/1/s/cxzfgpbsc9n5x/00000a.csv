"0","fit_em <- function(x, w, mu, sigma, eps) {"
"0",""
"0","  if_pass <- 0 # check if meet converging criteria"
"0","  i <- 0       # counter"
"0","  while(!if_pass){"
"0","    sum_pie <- sapply(1:length(w),   # sum pi for i from 1 to n"
"0","       FUN=function(k) sum(w[k]*dnorm(x, mu[k], sigma[k])/dmixt(x, w, mu, sigma)))"
"0","    w_new <- sum_pie/sum(sum_pie)"
"0","    "
"0","    sum_Xpie <- sapply(1:length(w), "
"0","       FUN=function(k) sum(x*w[k]*dnorm(x, mu[k], sigma[k])/dmixt(x, w, mu, sigma)))"
"0","    mu_new <- sum_Xpie/sum_pie "
"0","    "
"0","    sum_MSEpie <- sapply(1:length(w), "
"0","       FUN=function(k) sum((x-mu[k])^2*w[k]*dnorm(x, mu[k], sigma[k])/dmixt(x, w, mu, sigma)))"
"0","    sigma_new <- sqrt(sum_MSEpie/sum_pie)"
"0","    "
"0","    if_pass <- prod((w_new - w) < eps)*"
"0","               prod((mu_new - mu) < eps)*"
"0","               prod((sigma_new - sigma) < eps)"
"0","    "
"0","    i <- i + 1"
"0","    w <- w_new"
"0","    mu <- mu_new"
"0","    sigma <- sigma_new"
"0","  }"
"0","  cat('A total of ',i,' iterations.\n')"
"0","  return(list('w' = w, 'mu' = mu, 'sigma' = sigma))"
"0","}"
"0",""
"0","#results <- fit_em(X, c(0.4,0.6), c(-4,6), c(2,4), 10^-3)"
"0","#results"
